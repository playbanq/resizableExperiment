<!doctype hmtl>
<html lang='en'>
<head>
    <meta charset='utf-8'>
    <meta name='description' content=''>
    <title>Resizable Canvas</title>
    <style>
        body {
            margin: 0px;
        }
        #container {
            width: 1000px;
            background-color: #fcfcfc;
            margin: 0px auto;
        }
        #resizableCanvas {
            border: 1px dashed #ccc;
        }   
        .resizableContainer2 {
            width: 500px;
            height: 200px;
        }
    </style>
</head>
<body>
    <canvas id='resizableCanvas' class='resizableContainer'></canvas>
    <script>
        var canvas = document.getElementById('resizableCanvas');
            // canvas.width = '500';
            // canvas.height = '300';
        // Full page canvas
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        var context = canvas.getContext('2d'),
            canvasOffset = canvas.getBoundingClientRect(),
            screen = {
                width: window.innerWidth,
                height: window.innerHeight
            },
            ratio = {
                width: 1,
                height: 1
            },
            gravity = 30;

        // Platforms
        var platforms = [
            // [startX, heightY, widthX]
            [200, 300, 150],
            [450, 200, 200],
            [900, 250, 300]
        ];

        // Avatar
        var avatar = {
            mass: 0.05,
            radius: 10,
            position: {
                x: 250,
                y: 400
            },
            forces: {
                x: 0,
                y: gravity
            },
            speed: {
                x: 0,
                y: 0
            },
            keys: {
                'up': false,
                'down': false,
                'left': false,
                'right': false
            },
            walk: {
                force: 400
            },
            jump: {
                force: 400,
                duration: 300
            },
            jumping: false
        }
        
        // Clock
        var clock = {
            last: (new Date()).getTime(),
            current: null,
            fps: 30
        };

        // Handle window resize consequences
        window.onresize = function () {
            // Adjust avatar position according to window resizing      
            platforms.forEach(function (platform) {
                if (avatar.position.x > platform[0] * ratio.width && avatar.position.x  < platform[0] * ratio.width + platform[2]) {
                    avatar.position.x = platform[0] + avatar.position.x - platform[0] - (avatar.position.x - platform[0] * ratio.width) / (platform[2] * ratio.width);
                }
            });
            // 
            //avatar.position.y *= ratio.height;
        }

        // Render
        setInterval(function () {
            // Check actual delay
            clock.current = (new Date()).getTime();
            var frameDelay = clock.current - clock.last;
            clock.last = clock.current;

            context.clearRect(0, 0, canvasOffset.width, canvasOffset.height);
            // Adjust the canvas size to the window size
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // Adjust platform offsets according to the resizing
            if (window.innerWidth > screen.width/2) {
                ratio.width = canvas.width/screen.width;
            }
            if (window.innerHeight > screen.height/2) {
                ratio.height = canvas.height/screen.height;
            }

            // Draw platforms
            platforms.forEach(function (platform) {
                context.beginPath();
                context.moveTo(platform[0] * ratio.width, canvas.height - platform[1] * ratio.height);
                context.lineTo(platform[0] * ratio.width + platform[2], canvas.height - platform[1] * ratio.height);
                context.stroke();
            });

            // Compute avatar forces and resulting acceleration and speed
            avatar.speed.x = (avatar.forces.x/avatar.mass) * frameDelay/1000;
            avatar.speed.y += (avatar.forces.y/avatar.mass) * frameDelay/1000;
            // Compute avatar position
            avatar.position.x += avatar.speed.x * frameDelay/1000;
            avatar.position.y += avatar.speed.y * frameDelay/1000;

            if (avatar.position.y > screen.height) {
                avatar.speed.x = 0;
                avatar.speed.y = 0;
                avatar.forces.x = 0;
                avatar.position.x = 250;
                avatar.position.y = 400;
            }

            // Draw avatar
            context.beginPath();
            context.arc(avatar.position.x, avatar.position.y, avatar.radius, 0, 2 * Math.PI);
            context.fillStyle = '#999';
            context.fill();
            context.stroke();

            // avatar.speed.y = 0;
            var collision = false;
            for(var i = 0; i < platforms.length; i++) {
                var platform = platforms[i];
                if (avatar.position.x > platform[0] * ratio.width && avatar.position.x  < platform[0] * ratio.width + platform[2]) {
                    if (avatar.position.y + avatar.radius >= canvas.height - platform[1] * ratio.height &&
                        avatar.position.y + avatar.radius < canvas.height - platform[1] * ratio.height + 2 * avatar.radius) {
                        avatar.speed.y = 0;
                        avatar.forces.y = 0;
                        collision = true;
                        avatar.jumping = false;
                    }
                }
            };
            if (!collision) {
                avatar.forces.y = gravity;
            } 

        }, 1000/clock.fps);

        // Handle key events
        window.onkeydown = function (event) {
            var key = event.keyCode || event.charCode;

            switch (key) {
            case 37:
                avatar.forces.x = -avatar.walk.force;
                break;
            case 38:
                if (!avatar.keys.up && !avatar.jumping) {
                    avatar.keys.up = true;
                    avatar.forces.y = -avatar.jump.force;
                    avatar.jumping = true;
                    setTimeout(function () {
                        // if (avatar.keys.up) {
                            avatar.forces.y = gravity;
                            avatar.speed.y = 0;
                        // }
                    }, avatar.jump.duration);
                }
                break;
            case 39:
                avatar.forces.x = avatar.walk.force;
                break;
            case 40:
                break;
            default:
                break;
            }
        }
        window.onkeyup = function (event) {
            var key = event.keyCode || event.charCode;

            switch (key) {
            case 37:
                avatar.keys.left = false;
                avatar.forces.x = 0;
                break;
            case 38:
                avatar.keys.up = false;
                avatar.forces.y = 0;
                break;
            case 39:
                avatar.forces.right = false;
                avatar.forces.x = 0;
                break;
            case 40:
                avatar.keys.down = false;
                break;
            default:
                break;
            }
        }
        
    </script>
</body>
</html>